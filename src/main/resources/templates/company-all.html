<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head"/>
<body>
<div th:replace="fragments/navbar"></div>
<main class="container">
    <hgroup>
        <h1>Все компании</h1>
        <p>Просмотр и поиск зарегистрированных компаний</p>
    </hgroup>
    
    <!-- Сообщение об успехе -->
    <div th:if="${successMessage}" style="padding: 1rem; margin-bottom: 1rem; background-color: var(--pico-ins-color); border-radius: var(--pico-border-radius);">
        <p th:text="${successMessage}" style="margin: 0; color: white;"></p>
    </div>
    
    <!-- Форма поиска -->
    <form method="get" action="/companies/all">
        <div class="grid">
            <input type="search" 
                   name="search" 
                   th:value="${search}"
                   placeholder="Поиск по названию или описанию..." 
                   aria-label="Поиск">
            <button type="submit">Найти</button>
        </div>
    </form>
    
    <!-- Список компаний -->
    <div th:each="c : ${companyInfos}" class="card">
        <h3 th:text="${c.name}"></h3>
        <p><strong>Город:</strong> <span th:text="${c.town}"></span></p>
        <p><strong>Описание:</strong> <span th:text="${#strings.abbreviate(c.description, 100)}"></span></p>
        <a th:href="@{/companies/company-details/{company-name}(company-name=${c.name})}" role="button" class="outline">
            Подробнее
        </a>
    </div>
    
    <!-- Пагинация -->
    <nav th:if="${totalPages != null && totalPages > 1}" aria-label="Pagination">
        <ul style="display: flex; justify-content: center; list-style: none; padding: 0;">
            <li th:if="${currentPage > 0}">
                <a th:href="@{/companies/all(page=${currentPage - 1}, size=10)}" role="button" class="outline">Назад</a>
            </li>
            <li style="margin: 0 1rem; align-self: center;">
                <span>Страница <strong th:text="${currentPage + 1}"></strong> из <strong th:text="${totalPages}"></strong></span>
            </li>
            <li th:if="${currentPage + 1 < totalPages}">
                <a th:href="@{/companies/all(page=${currentPage + 1}, size=10)}" role="button" class="outline">Вперед</a>
            </li>
        </ul>
    </nav>
    
    <p th:if="${#lists.isEmpty(companyInfos)}" class="text-center">
        <em>Компании не найдены. Попробуйте изменить критерии поиска или добавьте новую компанию!</em>
    </p>
</main>
<footer th:replace="fragments/footer"></footer>
</body>
</html>